# リポジトリ設計書：airc

## 1. リポジトリ構造概要

### 1.1 全体構造

```
airc/
├── .gitignore
├── README.md
├── LICENSE
├── package.json
├── bin/
│   └── cli.js
└── profiles/
    ├── default/       ← 初期プロファイル（必須）
    │   ├── .github/
    │   │   ├── chatmodes/
    │   │   └── prompts/
    │   ├── .claude/
    │   └── CLAUDE.md
    ├── profileA/      ← カスタムプロファイル（追加可能）
    │   └── (同様の構造)
    └── profileB/
        └── (同様の構造)
```

### 1.2 プロファイルディレクトリの役割

`profiles/` 配下には、複数のプロファイル設定を格納します。各プロファイルは独立した設定セットを持ちます。

- **default**: 初期から用意されるデフォルトプロファイル（プロファイル指定なしの場合に使用）
- **profileA, profileB, ...**: 後から追加できるカスタムプロファイル

## 2. プロファイル内部構造

### 2.1 ディレクトリ構成

各プロファイルディレクトリは以下の構造を持ちます：

```
profiles/{profile-name}/
├── .github/
│   ├── chatmodes/          # GitHub Copilot Chat modes
│   │   ├── file1.md
│   │   └── file2.md
│   └── prompts/            # GitHub Copilot Prompts
│       ├── file1.md
│       └── file2.md
├── .claude/                # Claude AI 設定
│   ├── instructions/
│   │   └── *.md
│   └── README.md
└── CLAUDE.md               # Claude ルート設定ファイル
```

### 2.2 各ディレクトリの説明

| ディレクトリ          | 用途                                    | 対応AIツール       |
| --------------------- | --------------------------------------- | ------------------ |
| `.github/chatmodes/`  | GitHub Copilot のチャットモード設定     | GitHub Copilot     |
| `.github/prompts/`    | GitHub Copilot のプロンプト設定         | GitHub Copilot     |
| `.claude/`            | Claude AI の詳細設定                    | Claude             |
| ルート（`CLAUDE.md`） | Claude AI のルート設定ファイル（単一） | Claude             |

## 3. GitHub API 設計

### 3.1 ファイルリスト取得

GitHub API を使用してプロファイル配下のファイルを動的に取得します：

```
GitHub API エンドポイント:
https://api.github.com/repos/maru3460/airc/contents/profiles/{profile}

リクエスト例:
GET https://api.github.com/repos/maru3460/airc/contents/profiles/default
```

レスポンス例（一部抜粋）：
```json
[
  {
    "name": ".github",
    "path": "profiles/default/.github",
    "type": "dir"
  },
  {
    "name": "CLAUDE.md",
    "path": "profiles/default/CLAUDE.md",
    "type": "file"
  }
]
```

### 3.2 ファイルダウンロード URL

実ファイルは raw.githubusercontent.com からダウンロードします：

```
ベースURL: https://raw.githubusercontent.com/maru3460/airc/main

URL 構造:
https://raw.githubusercontent.com/maru3460/airc/main/{GitHub APIで取得したpath}

例:
https://raw.githubusercontent.com/maru3460/airc/main/profiles/default/.github/chatmodes/best-practices.md
https://raw.githubusercontent.com/maru3460/airc/main/profiles/default/.claude/instructions/basic.md
https://raw.githubusercontent.com/maru3460/airc/main/profiles/default/CLAUDE.md
```

## 4. ローカルパス設計

### 4.1 ダウンロード先パス構造

CLI 実行ディレクトリをルートとして、以下のパスに配置されます：

```
作業ディレクトリ/
├── .github/
│   ├── chatmodes/{filename}
│   └── prompts/{filename}
├── .claude/{filename}
└── {filename}  (ルートファイル)
```

### 4.2 パス変換ルール

GitHub リポジトリのパスからローカルパスへの変換：

```
GitHub パス:
profiles/default/.github/chatmodes/file.md

↓ profiles/{profile}/ を除去

ローカルパス:
.github/chatmodes/file.md
```

変換例：

| GitHub パス                                            | ローカルパス                         |
| ------------------------------------------------------ | ------------------------------------ |
| `profiles/default/.github/chatmodes/file.md`           | `.github/chatmodes/file.md`          |
| `profiles/default/.github/prompts/refactor.md`         | `.github/prompts/refactor.md`        |
| `profiles/default/.claude/instructions/basic.md`       | `.claude/instructions/basic.md`      |
| `profiles/default/CLAUDE.md`                           | `CLAUDE.md`                          |

## 5. プロファイル管理

### 5.1 プロファイル追加方法

新しいプロファイルを追加する手順：

1. `profiles/` 配下に新しいプロファイルディレクトリを作成
   ```bash
   mkdir -p profiles/profileA
   ```

2. 必要なディレクトリ構造を作成
   ```bash
   mkdir -p profiles/profileA/.github/chatmodes
   mkdir -p profiles/profileA/.github/prompts
   mkdir -p profiles/profileA/.claude
   ```

3. 設定ファイルを配置
   - `.github/chatmodes/` 配下に Copilot chatmodes ファイルを配置
   - `.github/prompts/` 配下に Copilot prompts ファイルを配置
   - `.claude/` 配下に Claude 設定ファイルを配置
   - ルートに `CLAUDE.md` を配置（必要に応じて）

4. GitHub にプッシュ
   ```bash
   git add profiles/profileA
   git commit -m "Add profileA configuration"
   git push
   ```

**重要**: GitHub API で動的にファイルリストを取得するため、コード側の修正は不要です。リポジトリにファイルを追加するだけで、自動的に認識されます。

### 5.2 プロファイル命名規則

- **小文字とハイフン推奨**: `profile-a`, `frontend-app` など
- **英数字とハイフンのみ**: 特殊文字やスペースは避ける
- **説明的な名前**: プロファイルの用途が分かる名前を付ける

## 6. ファイル命名規則

### 6.1 推奨命名規則

- **小文字とハイフン**: ファイル名は小文字とハイフンを使用（例: `react-best-practices.md`）
- **説明的な名前**: ファイルの内容が分かる名前を付ける
- **拡張子**: Markdown ファイルは `.md` を使用

### 6.2 特殊ファイル

- `CLAUDE.md`: Claude AI のルート設定ファイル（固定名）

## 7. .gitignore 設計

```
node_modules/
*.log
.DS_Store
dist/
```

## 8. セキュリティ考慮事項

### 8.1 アクセス制御

- リポジトリは public である必要があります（`raw.githubusercontent.com` 経由でアクセスするため）
- 機密情報をリポジトリに含めないこと

### 8.2 ファイル検証

- プロファイル名の検証（GitHub API で 404 が返る場合はエラー）
- ファイル名のバリデーションにより、ディレクトリトラバーサルを防止
- パスインジェクション対策（`../` などの不正なパスを拒否）
