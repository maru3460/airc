# マルチソース対応機能 - 使用例

## 基本的なワークフロー

### 1. 初回セットアップ

#### GitHub Organization リポジトリを登録

```bash
# 社内の private リポジトリを登録
airc add company github:my-org/ai-prompts --profile shared

# Token の指定（3つの方法から選択）

# 方法1: コマンドラインで直接指定
airc add company github:my-org/ai-prompts --profile shared --token ghp_xxxxxxxxxxxxx

# 方法2: 環境変数を指定
airc add company github:my-org/ai-prompts --profile shared --token-env GITHUB_TOKEN

# 方法3: 対話的に入力（最も安全）
airc add company github:my-org/ai-prompts --profile shared
# → "GitHub Token を入力してください: " というプロンプトが表示される
```

#### ローカルリポジトリを登録

```bash
# すでにクローンしたリポジトリを登録
airc add local-dev local:/home/user/repos/ai-config

# 相対パスも使用可能
airc add local-dev local:../ai-config
```

#### デフォルトソースを設定

```bash
# よく使うソースをデフォルトに設定
airc set-default company
```

### 2. 日常的な使用

```bash
# デフォルトソースから同期
airc sync

# 特定のソースから同期
airc sync local-dev

# 強制上書き
airc sync company --force

# 全ソースを一括同期
airc sync --all
```

### 3. ソースの管理

```bash
# 登録済みソースの一覧表示
airc list

# 出力例:
# Sources:
#   * default (maru3460/airc, profile: default)
#   * company (my-org/ai-prompts, profile: shared) [authenticated]
#   * local-dev (/home/user/repos/ai-config)
#
# Default source: company

# ソースの削除
airc remove local-dev

# デフォルトソースの変更
airc set-default default
```

## ユースケース別の使用例

### ユースケース 1: 社内チームでプロンプトを共有

**シナリオ**: 社内の開発チームで、共通の Claude プロンプトや GitHub Copilot チャットモードを使いたい

#### セットアップ（初回のみ）

```bash
# 社内リポジトリを登録
airc add team github:acme-corp/ai-team-config --profile engineering --token-env GITHUB_TOKEN

# デフォルトに設定
airc set-default team
```

#### 日常使用

```bash
# 毎朝、最新の設定を同期
airc sync

# または、プロジェクト開始時に同期
cd ~/profiles/my-app
airc sync
```

### ユースケース 2: 複数のプロジェクトで異なる設定を使い分け

**シナリオ**: 個人プロジェクト、社内プロジェクト、OSS プロジェクトで異なる AI 設定を使いたい

#### セットアップ

```bash
# 個人用（公開リポジトリ）
airc add personal github:myname/ai-config --profile personal

# 社内用（private リポジトリ）
airc add work github:company/ai-config --profile internal --token-env WORK_GITHUB_TOKEN

# OSS 用（公開リポジトリ）
airc add oss github:myname/ai-config --profile oss
```

#### 使い分け

```bash
# 個人用プロファイルで作業
cd ~/personal/my-blog
airc sync personal

# 社内用プロファイルで作業
cd ~/work/internal-app
airc sync work

# OSS 用プロファイルで作業
cd ~/oss/awesome-lib
airc sync oss
```

### ユースケース 3: ローカルで設定を開発→テスト→デプロイ

**シナリオ**: プロンプトをローカルで編集・テストしてから、チームのリポジトリに push したい

#### セットアップ

```bash
# ローカルの作業ディレクトリを登録
airc add local local:~/repos/ai-config-dev

# リモートのリポジトリも登録
airc add remote github:team/ai-config --profile production --token-env GITHUB_TOKEN
```

#### ワークフロー

```bash
# 1. ローカルで編集
cd ~/repos/ai-config-dev
# ... プロンプトファイルを編集 ...

# 2. 別のプロジェクトでテスト
cd ~/profiles/test-app
airc sync local  # ローカルの設定を適用してテスト

# 3. 問題なければリモートにデプロイ
cd ~/repos/ai-config-dev
git add .
git commit -m "Update prompts"
git push

# 4. チームメンバーは最新版を取得
airc sync remote
```

### ユースケース 4: デフォルト設定 + プロジェクト固有設定

**シナリオ**: 基本的には公開の設定を使いつつ、特定のプロジェクトでは社内設定を使いたい

#### セットアップ

```bash
# 公開設定（デフォルト）
airc add public github:maru3460/airc --profile default
airc set-default public

# 社内設定
airc add internal github:company/ai-config --profile confidential --token-env GITHUB_TOKEN
```

#### 使い分け

```bash
# ほとんどのプロジェクト: デフォルト設定を使用
cd ~/profiles/public-app
airc sync  # → public から同期

# 機密プロジェクト: 社内設定を使用
cd ~/profiles/confidential-app
airc sync internal  # → 社内設定を明示的に指定
```

## 設定ファイルの例

### ~/.config/airc/config.json

```json
{
  "sources": {
    "default": {
      "type": "github",
      "repo": "maru3460/airc",
      "profile": "default",
      "branch": "main"
    },
    "company": {
      "type": "github",
      "repo": "acme-corp/ai-team-config",
      "profile": "engineering",
      "branch": "main",
      "tokenEnv": "GITHUB_TOKEN"
    },
    "local-dev": {
      "type": "local",
      "path": "/home/user/repos/ai-config"
    }
  },
  "defaultSource": "company"
}
```

### 環境変数の設定例

```bash
# ~/.bashrc または ~/.zshrc に追加

# GitHub Personal Access Token（会社用）
export GITHUB_TOKEN="ghp_xxxxxxxxxxxxx"

# または、複数の Organization を使い分ける場合
export WORK_GITHUB_TOKEN="ghp_work_xxxxx"
export PERSONAL_GITHUB_TOKEN="ghp_personal_xxxxx"
```

## コマンドリファレンス

### ソース管理コマンド

```bash
# ソース追加
airc add <name> <source> [options]

# オプション:
#   --profile <name>        プロファイル名（GitHub の場合）
#   --token <token>         GitHub Token（直接指定）
#   --token-env <var>       GitHub Token の環境変数名
#   --branch <branch>       ブランチ名（デフォルト: main）

# ソース一覧
airc list

# ソース削除
airc remove <name>

# デフォルトソース設定
airc set-default <name>
```

### 同期コマンド

```bash
# 同期
airc sync [name] [options]

# オプション:
#   --force, -f    強制上書き（確認なし）
#   --all          全ソースを同期
```

### レガシーコマンド（後方互換性）

```bash
# 既存の使い方もサポート
airc              # → デフォルトソースを同期
airc -p my-profile   # → maru3460/airc/{profile} を同期（一時的）
airc --force      # → デフォルトソースを強制同期
```

## トラブルシューティング

### GitHub Token の権限不足

```bash
# エラー: 403 Forbidden
# → Token に repo スコープが必要

# 解決方法:
# 1. GitHub で Token を再生成（repo スコープを付与）
# 2. 環境変数を更新
export GITHUB_TOKEN="ghp_new_token_xxxxx"
# 3. 再試行
airc sync company
```

### ローカルパスが見つからない

```bash
# エラー: Path not found: /path/to/repo
# → パスが間違っているか、リポジトリが移動した

# 解決方法:
# 1. ソースを削除
airc remove local-dev
# 2. 正しいパスで再登録
airc add local-dev local:/correct/path/to/repo
```

### 設定ファイルの場所がわからない

```bash
# 設定ファイルの場所を表示
airc config show

# 出力例:
# Config file: /home/user/.config/airc/config.json
```
