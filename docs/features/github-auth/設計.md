# GitHub ãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼æ©Ÿèƒ½ - è¨­è¨ˆ

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### è¨­è¨ˆæ€æƒ³

1. **å¾Œæ–¹äº’æ›æ€§**: Token ãŒãªãã¦ã‚‚æ—¢å­˜ã®å‹•ä½œã‚’ç¶­æŒ
2. **ã‚·ãƒ³ãƒ—ãƒ«ã•**: ç’°å¢ƒå¤‰æ•°ã®ã¿ã§å‹•ä½œã€è¤‡é›‘ãªè¨­å®šä¸è¦
3. **å®‰å…¨æ€§**: Token ã‚’ãƒ­ã‚°ã‚„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å«ã‚ãªã„
4. **å°†æ¥ã®æ‹¡å¼µæ€§**: multi-source æ©Ÿèƒ½ã¸ã®ç§»è¡Œã‚’è¦‹æ®ãˆãŸè¨­è¨ˆ

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CLI Interface (cli.ts)              â”‚
â”‚  - ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°è§£æ                         â”‚
â”‚  - ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ (GITHUB_TOKEN)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  GitHub API Client â”‚
         â”‚  (github/api.ts)   â”‚
         â”‚                    â”‚
         â”‚ - fetchWithAuth()  â”‚
         â”‚ - checkRateLimit() â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚           â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœªèªè¨¼    â”‚ â”‚  èªè¨¼æ¸ˆ  â”‚ â”‚ ãƒ¬ãƒ¼ãƒˆåˆ¶é™â”‚
â”‚  ãƒªã‚¯ã‚¨ã‚¹ãƒˆâ”‚ â”‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆâ”‚ â”‚  ç›£è¦–     â”‚
â”‚            â”‚ â”‚         â”‚ â”‚           â”‚
â”‚ 60/æ™‚é–“   â”‚ â”‚5000/æ™‚é–“â”‚ â”‚ è­¦å‘Šè¡¨ç¤º  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### å¤‰æ›´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

```
src/
â”œâ”€â”€ cli.ts                      # ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿å‡¦ç†ã‚’è¿½åŠ 
â”œâ”€â”€ types.ts                    # èªè¨¼é–¢é€£ã®å‹å®šç¾©ã‚’è¿½åŠ 
â”œâ”€â”€ github/
â”‚   â”œâ”€â”€ api.ts                  # èªè¨¼ä»˜ã API å‘¼ã³å‡ºã—æ©Ÿèƒ½ã‚’è¿½åŠ 
â”‚   â””â”€â”€ download.ts             # èªè¨¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
â””â”€â”€ utils/
    â””â”€â”€ logger.ts               # ãƒ¬ãƒ¼ãƒˆåˆ¶é™è­¦å‘Šç”¨ãƒ­ã‚¬ãƒ¼ï¼ˆæ–°è¦ï¼‰
```

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### å‹å®šç¾© (`src/types.ts`)

```typescript
/**
 * GitHub API å‘¼ã³å‡ºã—ã‚ªãƒ—ã‚·ãƒ§ãƒ³
 */
export interface GitHubAPIOptions {
  /**
   * GitHub Personal Access Tokenï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
   */
  token?: string;
}

/**
 * GitHub API ãƒ¬ãƒ¼ãƒˆåˆ¶é™æƒ…å ±
 */
export interface RateLimitInfo {
  /**
   * ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®æœ€å¤§å€¤
   */
  limit: number;

  /**
   * æ®‹ã‚Šãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
   */
  remaining: number;

  /**
   * ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»ï¼ˆUnix timestampï¼‰
   */
  reset: number;

  /**
   * èªè¨¼æ¸ˆã¿ã‹ã©ã†ã‹
   */
  authenticated: boolean;
}

/**
 * ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã®çµæœ
 */
export interface DownloadResult {
  /**
   * ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«æ•°
   */
  filesDownloaded: number;

  /**
   * ã‚¹ã‚­ãƒƒãƒ—ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«æ•°
   */
  filesSkipped: number;

  /**
   * ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãƒ•ã‚¡ã‚¤ãƒ«æ•°
   */
  filesErrored: number;

  /**
   * ãƒ¬ãƒ¼ãƒˆåˆ¶é™æƒ…å ±ï¼ˆå–å¾—ã§ããŸå ´åˆï¼‰
   */
  rateLimit?: RateLimitInfo;
}
```

## ä¸»è¦ãªå®Ÿè£…è©³ç´°

### 1. ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿ (`src/cli.ts`)

```typescript
/**
 * ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ GitHub Token ã‚’å–å¾—
 */
function getGitHubToken(): string | undefined {
  const token = process.env.GITHUB_TOKEN;

  if (token) {
    // Token ã®å½¢å¼ã‚’ç°¡æ˜“ãƒã‚§ãƒƒã‚¯ï¼ˆghp_ ã§å§‹ã¾ã‚‹ã‹ï¼‰
    if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
      console.warn('âš ï¸  GITHUB_TOKEN ã®å½¢å¼ãŒä¸æ­£ã§ã™');
      return undefined;
    }
  }

  return token;
}
```

### 2. èªè¨¼ä»˜ã GitHub API å‘¼ã³å‡ºã— (`src/github/api.ts`)

```typescript
import type { GitHubAPIOptions, RateLimitInfo } from '../types';

/**
 * GitHub API ã‚’å‘¼ã³å‡ºã™ï¼ˆèªè¨¼å¯¾å¿œï¼‰
 */
export async function fetchWithAuth(
  url: string,
  options?: GitHubAPIOptions
): Promise<Response> {
  const headers: HeadersInit = {
    'Accept': 'application/vnd.github.v3+json',
    'User-Agent': 'airc-cli',
  };

  // Token ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
  if (options?.token) {
    headers['Authorization'] = `Bearer ${options.token}`;
  }

  const response = await fetch(url, {
    headers,
    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ10ç§’ï¼‰
    signal: AbortSignal.timeout(10000),
  });

  return response;
}

/**
 * ãƒ¬ãƒ¼ãƒˆåˆ¶é™æƒ…å ±ã‚’å–å¾—
 */
export function getRateLimitInfo(response: Response): RateLimitInfo | null {
  const limit = response.headers.get('X-RateLimit-Limit');
  const remaining = response.headers.get('X-RateLimit-Remaining');
  const reset = response.headers.get('X-RateLimit-Reset');

  if (!limit || !remaining || !reset) {
    return null;
  }

  return {
    limit: parseInt(limit, 10),
    remaining: parseInt(remaining, 10),
    reset: parseInt(reset, 10),
    authenticated: parseInt(limit, 10) > 60,
  };
}

/**
 * ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®è­¦å‘Šã‚’è¡¨ç¤º
 */
export function checkRateLimitWarning(rateLimit: RateLimitInfo): void {
  const { remaining, limit, reset, authenticated } = rateLimit;

  // æ®‹ã‚ŠãŒ10%æœªæº€ã«ãªã£ãŸã‚‰è­¦å‘Š
  const threshold = Math.floor(limit * 0.1);

  if (remaining < threshold) {
    const resetDate = new Date(reset * 1000);
    const authStatus = authenticated ? 'èªè¨¼æ¸ˆã¿' : 'æœªèªè¨¼';

    console.warn(
      `âš ï¸  GitHub API ãƒ¬ãƒ¼ãƒˆåˆ¶é™: æ®‹ã‚Š ${remaining}/${limit} ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (${authStatus})`
    );
    console.warn(`   ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»: ${resetDate.toLocaleString('ja-JP')}`);

    if (!authenticated) {
      console.warn(
        '   ğŸ’¡ GITHUB_TOKEN ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã¨ã€5,000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“ã¾ã§ä½¿ç”¨ã§ãã¾ã™'
      );
    }
  }
}

/**
 * ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚’å–å¾—ï¼ˆå†å¸°çš„ã€èªè¨¼å¯¾å¿œï¼‰
 */
export async function listFilesRecursive(
  owner: string,
  repo: string,
  path: string,
  branch: string = 'main',
  options?: GitHubAPIOptions
): Promise<GitHubFileInfo[]> {
  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
  const response = await fetchWithAuth(url, options);

  // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’ãƒã‚§ãƒƒã‚¯
  const rateLimit = getRateLimitInfo(response);
  if (rateLimit) {
    checkRateLimitWarning(rateLimit);
  }

  if (!response.ok) {
    if (response.status === 403) {
      const rateLimit = getRateLimitInfo(response);
      if (rateLimit && rateLimit.remaining === 0) {
        throw new Error(
          `GitHub API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«åˆ°é”ã—ã¾ã—ãŸã€‚ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»: ${new Date(
            rateLimit.reset * 1000
          ).toLocaleString('ja-JP')}`
        );
      }
    }

    throw new Error(
      `GitHub API ã‚¨ãƒ©ãƒ¼: ${response.status} ${response.statusText}`
    );
  }

  const data = await response.json();

  if (!Array.isArray(data)) {
    return [];
  }

  const files: GitHubFileInfo[] = [];

  for (const item of data) {
    if (item.type === 'file') {
      files.push({
        path: item.path,
        type: 'file',
        download_url: item.download_url,
      });
    } else if (item.type === 'dir') {
      // å†å¸°çš„ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¢ç´¢
      const subFiles = await listFilesRecursive(
        owner,
        repo,
        item.path,
        branch,
        options
      );
      files.push(...subFiles);
    }
  }

  return files;
}
```

### 3. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã®æ›´æ–° (`src/github/download.ts`)

```typescript
import type { GitHubAPIOptions, DownloadResult, RateLimitInfo } from '../types';
import { fetchWithAuth, getRateLimitInfo } from './api';

/**
 * ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆèªè¨¼å¯¾å¿œï¼‰
 */
export async function downloadFile(
  downloadUrl: string,
  localPath: string,
  options?: GitHubAPIOptions
): Promise<void> {
  const response = await fetchWithAuth(downloadUrl, options);

  if (!response.ok) {
    throw new Error(
      `ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—: ${response.status} ${response.statusText}`
    );
  }

  const content = await response.text();

  // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
  const dir = path.dirname(localPath);
  await fs.mkdir(dir, { recursive: true });

  // ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿
  await fs.writeFile(localPath, content, 'utf-8');
}

/**
 * è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
 */
export async function downloadFiles(
  files: GitHubFileInfo[],
  options?: GitHubAPIOptions & { force?: boolean }
): Promise<DownloadResult> {
  const result: DownloadResult = {
    filesDownloaded: 0,
    filesSkipped: 0,
    filesErrored: 0,
  };

  let lastRateLimit: RateLimitInfo | undefined;

  for (const file of files) {
    try {
      const localPath = convertToLocalPath(file.path);

      // æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒã‚§ãƒƒã‚¯
      const exists = await fs
        .access(localPath)
        .then(() => true)
        .catch(() => false);

      if (exists && !options?.force) {
        // ä¸Šæ›¸ãç¢ºèª
        const shouldOverwrite = await confirmOverwrite(localPath);
        if (!shouldOverwrite) {
          result.filesSkipped++;
          continue;
        }
      }

      // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
      await downloadFile(file.download_url, localPath, options);
      result.filesDownloaded++;

      console.log(`âœ… ${localPath}`);
    } catch (error) {
      result.filesErrored++;
      console.error(`âŒ ${file.path}: ${error.message}`);
    }
  }

  result.rateLimit = lastRateLimit;

  return result;
}
```

### 4. ãƒ­ã‚¬ãƒ¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (`src/utils/logger.ts`)

```typescript
/**
 * ãƒ¬ãƒ¼ãƒˆåˆ¶é™æƒ…å ±ã‚’è¡¨ç¤º
 */
export function logRateLimitSummary(rateLimit: RateLimitInfo): void {
  const { remaining, limit, authenticated } = rateLimit;
  const percentage = Math.floor((remaining / limit) * 100);

  console.log('\nğŸ“Š GitHub API ãƒ¬ãƒ¼ãƒˆåˆ¶é™æƒ…å ±:');
  console.log(`   æ®‹ã‚Š: ${remaining}/${limit} ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (${percentage}%)`);
  console.log(`   çŠ¶æ…‹: ${authenticated ? 'âœ… èªè¨¼æ¸ˆã¿' : 'âš ï¸  æœªèªè¨¼'}`);

  if (!authenticated) {
    console.log(
      '\nğŸ’¡ ãƒ’ãƒ³ãƒˆ: GITHUB_TOKEN ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã¨ã€5,000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“ã¾ã§ä½¿ç”¨ã§ãã¾ã™'
    );
  }
}
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 1. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼

```typescript
if (response.status === 403) {
  const rateLimit = getRateLimitInfo(response);

  if (rateLimit && rateLimit.remaining === 0) {
    const resetDate = new Date(rateLimit.reset * 1000);
    throw new Error(
      `GitHub API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«åˆ°é”ã—ã¾ã—ãŸã€‚\n` +
        `ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»: ${resetDate.toLocaleString('ja-JP')}\n` +
        `ç¾åœ¨ã®åˆ¶é™: ${rateLimit.limit}ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“ (${
          rateLimit.authenticated ? 'èªè¨¼æ¸ˆã¿' : 'æœªèªè¨¼'
        })`
    );
  }
}
```

### 2. Token å½¢å¼ã‚¨ãƒ©ãƒ¼

```typescript
function validateToken(token: string): boolean {
  // Personal Access Token ã®å½¢å¼ãƒã‚§ãƒƒã‚¯
  if (token.startsWith('ghp_') || token.startsWith('github_pat_')) {
    return true;
  }

  console.warn('âš ï¸  GITHUB_TOKEN ã®å½¢å¼ãŒä¸æ­£ã§ã™');
  console.warn('   æ­£ã—ã„å½¢å¼: ghp_xxxx ã¾ãŸã¯ github_pat_xxxx');
  return false;
}
```

### 3. èªè¨¼ã‚¨ãƒ©ãƒ¼

```typescript
if (response.status === 401) {
  throw new Error(
    'GitHub API èªè¨¼ã‚¨ãƒ©ãƒ¼: GITHUB_TOKEN ãŒç„¡åŠ¹ã§ã™ã€‚\n' +
      'æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚'
  );
}
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. Token ã®ãƒ­ã‚°å‡ºåŠ›é˜²æ­¢

```typescript
/**
 * ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ Token ã‚’é™¤å»
 */
function sanitizeErrorMessage(message: string, token?: string): string {
  if (!token) return message;

  // Token ã‚’ "*****" ã«ç½®æ›
  return message.replace(new RegExp(token, 'g'), '*****');
}
```

### 2. Token ã®æ¤œè¨¼

```typescript
/**
 * Token ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ç¢ºèªï¼ˆå°†æ¥çš„ãªæ‹¡å¼µï¼‰
 */
async function validateTokenScopes(token: string): Promise<string[]> {
  const response = await fetch('https://api.github.com/user', {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  });

  const scopes = response.headers.get('X-OAuth-Scopes');
  return scopes ? scopes.split(', ') : [];
}
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

### 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ï¼ˆå°†æ¥çš„ãªå®Ÿè£…ï¼‰

```typescript
interface CacheEntry {
  files: GitHubFileInfo[];
  timestamp: number;
  etag: string;
}

/**
 * ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
 */
class FileListCache {
  private cache = new Map<string, CacheEntry>();
  private ttl = 5 * 60 * 1000; // 5åˆ†

  async get(key: string): Promise<GitHubFileInfo[] | null> {
    const entry = this.cache.get(key);

    if (!entry) return null;

    // TTL ãƒã‚§ãƒƒã‚¯
    if (Date.now() - entry.timestamp > this.ttl) {
      this.cache.delete(key);
      return null;
    }

    return entry.files;
  }

  set(key: string, files: GitHubFileInfo[], etag: string): void {
    this.cache.set(key, {
      files,
      timestamp: Date.now(),
      etag,
    });
  }
}
```

### 2. ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥

```typescript
/**
 * ãƒªãƒˆãƒ©ã‚¤ä»˜ã fetch
 */
async function fetchWithRetry(
  url: string,
  options: RequestInit,
  maxRetries = 3
): Promise<Response> {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const response = await fetch(url, options);

      // 429 (Too Many Requests) ã®å ´åˆã¯ãƒªãƒˆãƒ©ã‚¤
      if (response.status === 429) {
        const retryAfter = response.headers.get('Retry-After');
        const delay = retryAfter ? parseInt(retryAfter) * 1000 : 1000 * (i + 1);

        console.warn(`âš ï¸  ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«åˆ°é”ã€‚${delay}ms å¾Œã«ãƒªãƒˆãƒ©ã‚¤ã—ã¾ã™...`);
        await new Promise(resolve => setTimeout(resolve, delay));
        continue;
      }

      return response;
    } catch (error) {
      if (i === maxRetries - 1) throw error;

      console.warn(`âš ï¸  ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¤±æ•—ã€‚ãƒªãƒˆãƒ©ã‚¤ ${i + 1}/${maxRetries}...`);
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }

  throw new Error('æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°ã«åˆ°é”ã—ã¾ã—ãŸ');
}
```

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```typescript
describe('GitHub API', () => {
  describe('fetchWithAuth', () => {
    it('Token ãªã—ã§ API ã‚’å‘¼ã³å‡ºã›ã‚‹', async () => {
      const response = await fetchWithAuth('https://api.github.com/repos/maru3460/airc');
      expect(response.ok).toBe(true);
    });

    it('Token ã‚ã‚Šã§ API ã‚’å‘¼ã³å‡ºã›ã‚‹', async () => {
      const response = await fetchWithAuth(
        'https://api.github.com/repos/maru3460/airc',
        { token: process.env.GITHUB_TOKEN }
      );
      expect(response.ok).toBe(true);
    });
  });

  describe('getRateLimitInfo', () => {
    it('ãƒ¬ãƒ¼ãƒˆåˆ¶é™æƒ…å ±ã‚’å–å¾—ã§ãã‚‹', () => {
      const mockResponse = new Response(null, {
        headers: {
          'X-RateLimit-Limit': '5000',
          'X-RateLimit-Remaining': '4999',
          'X-RateLimit-Reset': '1634567890',
        },
      });

      const rateLimit = getRateLimitInfo(mockResponse);

      expect(rateLimit).toEqual({
        limit: 5000,
        remaining: 4999,
        reset: 1634567890,
        authenticated: true,
      });
    });
  });
});
```

### 2. çµ±åˆãƒ†ã‚¹ãƒˆ

```typescript
describe('èªè¨¼æ©Ÿèƒ½ã®çµ±åˆãƒ†ã‚¹ãƒˆ', () => {
  it('Token ãªã—ã§ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹', async () => {
    const files = await listFilesRecursive('maru3460', 'airc', 'profiles/default');
    expect(files.length).toBeGreaterThan(0);
  });

  it('Token ã‚ã‚Šã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹', async () => {
    const files = await listFilesRecursive(
      'maru3460',
      'airc',
      'profiles/default',
      'main',
      { token: process.env.GITHUB_TOKEN }
    );
    expect(files.length).toBeGreaterThan(0);
  });
});
```

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥

### æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®äº’æ›æ€§

- **Token ãªã—**: æ—¢å­˜ã®å‹•ä½œã‚’ç¶­æŒï¼ˆæœªèªè¨¼ï¼‰
- **Token ã‚ã‚Š**: è‡ªå‹•çš„ã«èªè¨¼ä»˜ããƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½¿ç”¨

### æ®µéšçš„ãªå°å…¥

1. **ãƒ•ã‚§ãƒ¼ã‚º1**: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã® Token èª­ã¿è¾¼ã¿ï¼ˆã“ã®æ©Ÿèƒ½ï¼‰
2. **ãƒ•ã‚§ãƒ¼ã‚º2**: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®ç›£è¦–ã¨è­¦å‘Šï¼ˆã“ã®æ©Ÿèƒ½ï¼‰
3. **ãƒ•ã‚§ãƒ¼ã‚º3**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å¯¾å¿œï¼ˆmulti-source æ©Ÿèƒ½ï¼‰
4. **ãƒ•ã‚§ãƒ¼ã‚º4**: Private ãƒªãƒã‚¸ãƒˆãƒªå¯¾å¿œï¼ˆmulti-source æ©Ÿèƒ½ï¼‰

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã®ä½œæˆ
2. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®è¿½åŠ 
3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ï¼ˆREADME æ›´æ–°ï¼‰
4. multi-source æ©Ÿèƒ½ã¸ã®ç§»è¡Œæº–å‚™
