# GitHub トークン認証機能 - 概要

## 目的

airc に GitHub Personal Access Token を使った認証機能を追加し、以下の課題を解決する：

- **レート制限の緩和**: 未認証時の 60リクエスト/時間 から 5,000リクエスト/時間 に拡大
- **Private リポジトリ対応の準備**: 将来的な multi-source 機能の基盤を構築
- **安定性の向上**: 大量のファイルがあるプロジェクトでも安定して動作

## 背景・解決する課題

### 現状の制限

現在の airc は、GitHub API を**未認証**で使用しているため、以下の制限があります：

1. **レート制限**: 60リクエスト/時間（IP アドレスごと）
2. **Public リポジトリのみ**: 認証機能がないため、private リポジトリにアクセスできない
3. **大規模プロジェクトへの対応不足**: ファイル数が多い場合、レート制限に到達する可能性がある

### GitHub API のレート制限

| 認証状態 | レート制限 | 制限の単位 |
|---------|-----------|----------|
| 未認証 | 60リクエスト/時間 | IP アドレス |
| 認証済み（Personal Access Token） | 5,000リクエスト/時間 | ユーザーアカウント |
| 認証済み（GitHub App、Enterprise Cloud） | 15,000リクエスト/時間 | Organization |

参考: [GitHub REST API レート制限](https://docs.github.com/ja/rest/using-the-rest-api/rate-limits-for-the-rest-api?apiVersion=2022-11-28)

### 解決する課題

- **レート制限の緩和**: Token を使用することで、5,000リクエスト/時間まで拡大（約83倍）
- **安定性の向上**: 大規模プロジェクトでもレート制限に引っかからない
- **将来の拡張性**: multi-source 機能（private リポジトリ対応）の基盤を構築

## 主要機能

### 1. 環境変数からの Token 読み込み

環境変数 `GITHUB_TOKEN` から Personal Access Token を読み込みます：

```bash
export GITHUB_TOKEN="ghp_xxxxxxxxxxxxx"
airc  # Token を自動的に使用
```

### 2. 認証付き GitHub API 呼び出し

Token が設定されている場合、自動的に認証ヘッダーを付与します：

```
Authorization: Bearer ghp_xxxxxxxxxxxxx
```

### 3. レート制限の監視と警告

API レスポンスヘッダーから残りリクエスト数を確認し、警告を表示します：

```
⚠️  GitHub API レート制限: 残り 10/5000 リクエスト
   リセット時刻: 2025-10-18 15:30:00
```

### 4. 後方互換性

Token がない場合でも、既存の動作（未認証）を維持します：

- Token なし → 未認証で動作（60リクエスト/時間）
- Token あり → 認証ありで動作（5,000リクエスト/時間）

## 対象ユーザー

- **大規模プロジェクトを扱う開発者**: ファイル数が多く、レート制限に到達しやすい環境
- **頻繁に同期する開発者**: 1時間に複数回同期する場合
- **将来的に private リポジトリを使いたい開発者**: multi-source 機能への移行準備

## 実装フェーズ

### フェーズ1: 基礎実装（この機能）

- [x] 環境変数 `GITHUB_TOKEN` からの読み込み
- [x] 認証付き GitHub API 呼び出し
- [x] レート制限の監視と警告
- [x] ドキュメント整備

### フェーズ2: multi-source 機能（将来）

- [ ] 設定ファイル（`~/.config/airc/config.json`）の導入
- [ ] 複数ソースの管理（GitHub、ローカル）
- [ ] Private リポジトリ対応
- [ ] ソース別の認証情報管理

## セキュリティ考慮事項

### Token の安全な管理

1. **環境変数を使用**（推奨）
   ```bash
   export GITHUB_TOKEN="ghp_xxxxxxxxxxxxx"
   ```

2. **Token をコードやログに含めない**
   - エラーメッセージに Token を表示しない
   - デバッグログにも出力しない

3. **最小限のスコープ**
   - Public リポジトリのみの場合: スコープ不要（空でOK）
   - Private リポジトリの場合（将来）: `repo` スコープのみ

### Token の生成方法

1. GitHub にログイン
2. Settings > Developer settings > Personal access tokens > Tokens (classic)
3. "Generate new token" をクリック
4. スコープを選択（Public リポジトリのみなら空でOK）
5. Token をコピーして環境変数に設定

## 次のステップ

- [設計](./設計.md): 技術的な設計詳細
- [使用例](./使用例.md): 具体的なコマンド例とユースケース
